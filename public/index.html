<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Employee Management Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>

  <style>
    :root{--primary:#0d6efd;--card-radius:12px;}
    body{background: linear-gradient(180deg,#f6f9ff 0%, #ffffff 100%);min-height:100vh;}
    .card-stats{border-radius:var(--card-radius);box-shadow:0 8px 20px rgba(13,110,253,0.08);}
    .table-actions .btn{padding:6px 10px;border-radius:8px;}
    .search-input{max-width:420px;}
    .table thead th{border-bottom:0;}
    .table tbody tr{transition:background .12s ease;}
    .table tbody tr:hover{background:rgba(13,110,253,0.04);}
    .modal-header.bg-primary{background:linear-gradient(90deg,var(--primary),#0069d6);color:white;border-top-left-radius:var(--card-radius);border-top-right-radius:var(--card-radius);}
    .page-container{padding:28px 20px;}
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-white border-bottom">
    <div class="container-fluid">
      <a class="navbar-brand text-dark" href="#"><i class="fa-solid fa-briefcase me-2 text-primary"></i> Employee Management</a>
      <div class="d-flex align-items-center">
        <button class="btn btn-outline-secondary btn-sm me-2">Help</button>
        <img src="https://api.dicebear.com/7.x/initials/svg?seed=EP" alt="avatar" width="36" class="rounded-circle border">
      </div>
    </div>
  </nav>

  <div class="container page-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h3 class="mb-1">Dashboard</h3>
        <p class="text-muted mb-0">Manage your team — Add, edit, remove employees and view statistics.</p>
      </div>
      <div>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#employeeModal"><i class="fa-solid fa-plus me-2"></i> Add Employee</button>
      </div>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card card-stats p-3">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-primary text-white rounded p-3"><i class="fa-solid fa-users fa-lg"></i></div>
            </div>
            <div>
              <small class="text-muted">Total Employees</small>
              <h4 id="totalEmp" class="mb-0">0</h4>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-stats p-3">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-primary text-white rounded p-3"><i class="fa-solid fa-wallet fa-lg"></i></div>
            </div>
            <div>
              <small class="text-muted">Total Salary</small>
              <h4 id="totalSalary" class="mb-0">0</h4>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-stats p-3">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-primary text-white rounded p-3"><i class="fa-solid fa-chart-simple fa-lg"></i></div>
            </div>
            <div>
              <small class="text-muted">Average Salary</small>
              <h4 id="avgSalary" class="mb-0">0</h4>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-4 p-3">
      <div class="row g-2 align-items-center">
        <div class="col-md-4">
          <input id="search" class="form-control search-input" placeholder="Search by name, email or position...">
        </div>
        <div class="col-md-3">
          <select id="sortSelect" class="form-select">
            <option value="">Sort (Default)</option>
            <option value="name">Name ↑</option>
            <option value="name_desc">Name ↓</option>
            <option value="position">Position ↑</option>
            <option value="position_desc">Position ↓</option>
            <option value="salary">Salary ↑</option>
            <option value="salary_desc">Salary ↓</option>
          </select>
        </div>
        <div class="col-md-5 text-end">
          <small class="text-muted me-3">Showing <span id="countDisplay">0</span> results</small>
          <button id="refreshBtn" class="btn btn-outline-primary btn-sm"><i class="fa-solid fa-rotate"></i> Refresh</button>
        </div>
      </div>
    </div>

    <div class="card p-0 shadow-sm">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Position</th>
              <th>Salary</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="employeeTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="modal fade" id="employeeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary">
          <h5 class="modal-title">Add Employee</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="employeeForm">
            <input type="hidden" id="employeeId">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" id="name" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email address</label>
              <input type="email" id="email" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Position</label>
              <input type="text" id="position" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Salary</label>
              <input type="number" id="salary" class="form-control" required>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">Save Employee</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const employeeForm = document.getElementById('employeeForm');
    const employeeTable = document.getElementById('employeeTable');
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sortSelect');
    const countDisplay = document.getElementById('countDisplay');
    const totalEmpEl = document.getElementById('totalEmp');
    const totalSalaryEl = document.getElementById('totalSalary');
    const avgSalaryEl = document.getElementById('avgSalary');
    const refreshBtn = document.getElementById('refreshBtn');

    let employees = [];

    async function fetchEmployees(){
      try {
        const res = await fetch('/api/employees');
        employees = await res.json();
        render();
      } catch (err) {
        console.error('Fetch error', err);
        alert('Could not fetch employees. Make sure the server is running.');
      }
    }

    function formatCurrency(v){
      if(v === undefined || v === null || v === '') return '-';
      return parseFloat(v).toLocaleString();
    }

    function render(){
      let list = [...employees];
      const q = searchInput.value.trim().toLowerCase();
      if(q){
        list = list.filter(e =>
          (e.name||'').toLowerCase().includes(q) ||
          (e.email||'').toLowerCase().includes(q) ||
          (e.position||'').toLowerCase().includes(q)
        );
      }

      const sortVal = sortSelect.value;
      if(sortVal){
        const [field, dir] = sortVal.includes('_') ? sortVal.split('_') : [sortVal, 'asc'];
        list.sort((a,b) => {
          if(field === 'salary'){
            return dir === 'desc' ? b.salary - a.salary : a.salary - b.salary;
          } else {
            const av = (a[field]||'').toString().toLowerCase();
            const bv = (b[field]||'').toString().toLowerCase();
            return dir === 'desc' ? bv.localeCompare(av) : av.localeCompare(bv);
          }
        });
      }

      employeeTable.innerHTML = '';
      for(const emp of list){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><div class="fw-semibold">${emp.name || '-'}</div></td>
          <td>${emp.email || '-'}</td>
          <td>${emp.position || '-'}</td>
          <td>${formatCurrency(emp.salary)}</td>
          <td class="text-center table-actions">
            <button class="btn btn-sm btn-outline-primary me-1" onclick="onEdit(${emp.id})"><i class="fa-solid fa-pen-to-square"></i></button>
            <button class="btn btn-sm btn-outline-danger" onclick="onDelete(${emp.id})"><i class="fa-solid fa-trash"></i></button>
          </td>
        `;
        employeeTable.appendChild(tr);
      }

      const total = employees.length;
      const totalSalary = employees.reduce((s,e)=> s + (parseFloat(e.salary)||0), 0);
      const avg = total ? (totalSalary/total).toFixed(2) : 0;

      totalEmpEl.innerText = total;
      totalSalaryEl.innerText = formatCurrency(totalSalary);
      avgSalaryEl.innerText = formatCurrency(avg);
      countDisplay.innerText = list.length;
    }

    employeeForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('employeeId').value;
      const payload = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        position: document.getElementById('position').value,
        salary: document.getElementById('salary').value
      };

      try {
        if(id){
          await fetch('/api/employees/' + id, { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        } else {
          await fetch('/api/employees', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        }
        const modalEl = document.getElementById('employeeModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        modal.hide();
        employeeForm.reset();
        document.getElementById('employeeId').value = '';
        fetchEmployees();
      } catch(err){
        console.error(err);
        alert('Error saving employee');
      }
    });

    function onEdit(id){
      const emp = employees.find(e=> e.id === id);
      if(!emp) return alert('Employee not found');
      document.getElementById('employeeId').value = emp.id;
      document.getElementById('name').value = emp.name;
      document.getElementById('email').value = emp.email;
      document.getElementById('position').value = emp.position;
      document.getElementById('salary').value = emp.salary;
      const modal = new bootstrap.Modal(document.getElementById('employeeModal'));
      modal.show();
    }

    async function onDelete(id){
      if(!confirm('Are you sure you want to delete this employee?')) return;
      try {
        await fetch('/api/employees/' + id, { method:'DELETE' });
        fetchEmployees();
      } catch(err){
        console.error(err);
        alert('Delete failed');
      }
    }

    searchInput.addEventListener('input', render);
    sortSelect.addEventListener('change', render);
    refreshBtn.addEventListener('click', fetchEmployees);

    fetchEmployees();
  </script>
</body>
</html>
